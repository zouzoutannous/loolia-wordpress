'use strict';(function(g,B,f,u){g.ThemifyGradient=function(n,A){const w={gradient:g.ThemifyGradient.default,width:173,height:15,point:8,angle:180,circle:!1,type:"linear",onChange(){},onInit(){}},v=g(n);let l,k,m,p,q,t,d=[];this.initSwatchesFlag=this.isInit=!1;this.settings={};this.__constructor=function(){this.settings=g.extend({},w,A);this.update();this.settings.onInit();this.isInit=!0;return this};this.updateSettings=function(a){this.settings=g.extend({},w,a);this.update();return this};this.update=
function(){this._setupPoints();this._setup();this._render()};this.getCSSvalue=function(){const a=[],b="radial"===this.settings.type?this.settings.circle?"circle,":"":this.settings.angle+"deg,";for(let b=0,e=d.length;b<e;++b)a.push(d[b][1]+" "+d[b][0]);return this.settings.type+"-gradient("+b+a.join(", ")+")"};this.getString=function(){let a="";for(let b=0,c=d.length;b<c;++b)a+=d[b][0]+" "+d[b][1]+"|";return a.substr(0,a.length-1)};this.setType=function(a){this.settings.type=a;this.settings.onChange(this.getString(),
this.getCSSvalue())};this.setAngle=function(a){this.settings.angle=a;this.settings.onChange(this.getString(),this.getCSSvalue())};this.setRadialCircle=function(a){this.settings.circle=a;this.settings.onChange(this.getString(),this.getCSSvalue())};this._setupPoints=function(){d=[];d=Array.isArray(this.settings.gradient)?this.settings.gradient:this._getGradientFromString(this.settings.gradient)};this._setup=function(){const a=this,b=f.createDocumentFragment(),c=f.createElement("div"),e=f.createElement("div"),
x=f.createElement("span"),h=f.createElement("span"),y=f.createElement("div"),z=f.createElement("div");q=f.createElement("a");m=f.createElement("div");p=f.createElement("input");l=f.createElement("div");k=f.createElement("div");let r=f.createElement("canvas");c.className="themifyGradient tf_rel";r.width=this.settings.width;r.height=this.settings.height;l.className="points";m.className="point-color";x.className="gradient_delimiter";h.className="gradient_percent";h.innerHTML="%";p.type="text";p.className=
"point-position";q.className="gradient-point-delete tf_close";q.href="#";e.className="gradient-pointer-info";k.className="content";y.style.backgroundColor="#00ff00";z.className="gradient-pointer-arrow";m.appendChild(y);e.appendChild(z);k.appendChild(m);k.appendChild(x);k.appendChild(p);k.appendChild(h);k.appendChild(q);b.appendChild(l);b.appendChild(r);e.appendChild(k);b.appendChild(e);for(c.appendChild(b);n.firstChild;)n.removeChild(n.firstChild);n.appendChild(c);this.initSwatchesFlag||(n.parentNode.appendChild(this.swatchesHTML()),
this.initSwatches(),this.initSwatchesFlag=!0);k=g(k);m=g(m);p=g(p);q=g(q);l=g(l);t=r.getContext("2d");r=g(r);r.off("click").on("click",function(b){const c=g(this).offset();let e="rgba(0,0,0, 1)",h=999999999999;b=b.pageX-c.left;b=Math.round(100*b/a.settings.width);for(let a=0,c=d.length;a<c;++a)d[a][0]=parseInt(d[a][0]),d[a][0]<b&&b-d[a][0]<h?(h=b-d[a][0],e=d[a][1]):d[a][0]>b&&d[a][0]-b<h&&(h=d[a][0]-b,e=d[a][1]);d.push([b+"%",e]);d.sort(a._sortByPosition);a._render();for(let c=0,e=d.length;c<e;++c)d[c][0]===
b+"%"&&a._selectPoint(l.find(".point:eq("+c+")")[0]);"visual"===u.mode&&setTimeout(a._colorPickerPosition,315)});this.pointEvents()};this.pointEvents=function(){const a=this,b=u.Utils.getMouseEvents(),c=function(b){const c=b.target;if(c.classList.contains("point-position")){let e=parseInt(c.value.trim());isNaN(e)?e=0:0>e?e=Math.abs(e):98<=e&&(e=98);"focusout"!==b.type?(e=Math.round(e*a.settings.width/100),g(c).closest(".themifyGradient").find(".themify_current_point").css("left",e),a._renderCanvas()):
c.value=e}};k[0].addEventListener("focusout",c,{passive:!1});k[0].addEventListener("keyup",c,{passive:!1});l[0].addEventListener("keyup",function(b){const c=b.keyCode||b.which||0;8!==c&&46!==c||"INPUT"===f.activeElement.tagName||(p.focus(),a.removePoint(b))},{passive:!1});l[0].addEventListener("click",function(b){b.target.classList.contains("point")&&(a._selectPoint(b.target),"visual"===u.mode&&a._colorPickerPosition())},{passive:!0});l[0].addEventListener(b.mousedown,function(c){if(("touchstart"===
c.type||1===c.which)&&c.target.classList.contains("point")){c.stopImmediatePropagation();let e;const h=c.target,d=function(a){n.focus();h.classList.add("tb_gradient_drag_point");this.body.classList.add("tb_start_animate","tb_move_drag","tb_gradient_drag")},g=a.settings.width,k=parseFloat(window.getComputedStyle(h).getPropertyValue("margin-left"))||0,l=h.offsetLeft-(c.touches?c.touches[0].clientX:c.clientX),m=function(b){b.stopImmediatePropagation();e&&cancelAnimationFrame(e);e=requestAnimationFrame(function(){let c=
l+(b.touches?b.touches[0].clientX:b.clientX)-k;c>g?c=g:0>c&&(c=0);h.style.left=c+"px";a._selectPoint(h,!0);a._renderCanvas()})};f.addEventListener(b.mouseup,function(a){a.stopImmediatePropagation();this.removeEventListener(b.mousemove,d,{passive:!0,once:!0});this.removeEventListener(b.mousemove,m,{passive:!0});this.body.classList.remove("tb_start_animate","tb_move_drag","tb_gradient_drag");h.classList.remove("tb_gradient_drag_point");n.focus()},{passive:!0,once:!0});f.addEventListener(b.mousemove,
d,{passive:!0,once:!0});f.addEventListener(b.mousemove,m,{passive:!0})}},{passive:!0})};this._render=function(){this._initGradientPoints();this._renderCanvas()};this._colorPickerPosition=function(){const a=ThemifyBuilderCommon.Lightbox.$lightbox,b=k.find(".minicolors"),c=b.find(".minicolors-panel");0<c.length&&(a.offset().left+a.width()<=c.offset().left+c.width()?b.addClass("tb_minicolors_right"):b.removeClass("tb_minicolors_right"))};this._initGradientPoints=function(){const a=f.createDocumentFragment();
for(;l[0].firstChild;)l[0].removeChild(l[0].firstChild);for(let b=0,c=d.length;b<c;++b){let c=f.createElement("div");c.className="point";c.style.backgroundColor=d[b][1];c.style.left=parseInt(d[b][0])*this.settings.width/100+"px";a.appendChild(c)}l[0].appendChild(a)};this.hexToRgb=function(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,c,e,d){return c+c+e+e+d+d});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:
null};this._selectPoint=function(a,b){if(a){var c=this,e=parseInt(a.style.left);p.val(Math.round(e/this.settings.width*100));e-=30;0>e&&f.body.classList.contains("tb_module_panel_docked")&&(e=3);k[0].parentNode.style.marginLeft=e+"px";if(b)return!1;v.focus();var d=g(a);d.addClass("themify_current_point").siblings().removeClass("themify_current_point");b=d.css("backgroundColor");a=b.substr(4,b.length);a=a.substr(0,a.length-1);v.find(".point-color .minicolors").remove();a=m.find(".themify-color-picker");
0===a.length&&(a=g('<input type="text" class="themify-color-picker" />'),a.appendTo(m).minicolors({opacity:!0,changeDelay:10,change(a,b){a=c.hexToRgb(a);a||(a={r:255,g:255,b:255},b=1);d.css("backgroundColor","rgba("+a.r+","+a.g+","+a.b+","+b+")");c._renderCanvas()}}),v.find(".minicolors").first().addClass("minicolors-focus"),q.off("click").on("click",this.removePoint.bind(this)));b=b.replace(/^rgba?\(|\s+|\)$/g,"").split(",");e=4===b.length?b.pop():1;b=this._rgbToHex(b);a.val(b).attr("data-opacity",
e).data("opacity",e).minicolors("settings",{value:b})}};this._renderCanvas=function(){const a=l[0].getElementsByClassName("point");d=[];for(let b=0,c=a.length;b<c;++b){let c=Math.round(parseInt(a[b].style.left)/this.settings.width*100);d.push([c+"%",a[b].style.backgroundColor])}d.sort(this._sortByPosition);this._renderToCanvas();if(this.isInit)this.settings.onChange(this.getString(),this.getCSSvalue())};this._renderToCanvas=function(){const a=t.createLinearGradient(0,0,this.settings.width,0);for(let b=
0,c=d.length;b<c;++b)a.addColorStop(parseInt(d[b][0])/100,d[b][1]);t.clearRect(0,0,this.settings.width,this.settings.height);t.fillStyle=a;t.fillRect(0,0,this.settings.width,this.settings.height)};this._getGradientFromString=function(a){const b=[];a=a.split("|");for(let e=0,d=a.length;e<d;++e){var c=void 0;let d=a[e];c=d.indexOf("%");let f=d.substr(c-3,c);"100"===f||"100%"===f?c="100%":(c=1<c?parseInt(d.substr(c-2,c)):parseInt(d.substr(c-1,c)),c+="%");b.push([c,d.replace(c,"")])}return b};this._rgbToHex=
function(a){function b(a){a=parseInt(a,10);if(isNaN(a))return"00";a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)}const c=a[1],e=a[2];return"#"+b(a[0])+b(c)+b(e)};this._sortByPosition=function(a,b){a=parseInt(a[0]);b=parseInt(b[0]);return a<b?-1:a>b?1:0};this.removePoint=function(a){a.preventDefault();if(1<d.length){d.splice((void 0).index(),1);const a=k[0].parentNode;a.style.display="none";setTimeout(function(){a.style.display=""},50);this._render()}};
this.swatchesHTML=function(){const a=f.createDocumentFragment(),b=f.createElement("div"),c=f.createElement("ul"),e=themifyColorManager.makeImportExportDropdown(),d=f.createElement("a");d.className="tb_gradient_add_swatch tf_plus_icon";let h=f.createElement("span");h.className="themify_tooltip";h.innerText=ThemifyConstructor.label.save_gradient;d.appendChild(h);d.href="#";d.addEventListener("click",this.saveSwatch.bind(this));b.className="tb_cm_dropdown_icon";b.tabIndex=1;h=f.createElement("span");
h.className="themify_tooltip";h.innerText=ThemifyConstructor.label.ie_gradient;b.appendChild(h);e.addEventListener("click",this.swatchesDropdownClicked.bind(this));b.appendChild(u.Utils.getIcon("ti-import"));b.appendChild(e);c.className="tb_gradient_swatches";c.addEventListener("click",this.swatchClicked.bind(this));a.appendChild(d);a.appendChild(b);a.appendChild(c);return a};this.swatchesDropdownClicked=function(a){a.preventDefault();a.stopPropagation();a=a.target;const b=a.classList;b.contains("tb_cm_export")?
(a.parentNode.parentNode.parentNode.blur(),f.location.assign(themifyCM.exportGradientsURL)):b.contains("tb_cm_import")&&(a.parentNode.parentNode.parentNode.blur(),themifyColorManager.importColors("gradients"))};this.saveSwatch=function(){if(""===this.getString()||""===this.getCSSvalue())return!1;var a=Object.keys(themifyCM.gradients),b=this.getCSSvalue();for(let c=a.length-1;-1<c;--c)if(themifyCM.gradients[a[c]].css===b)return null;a=themifyColorManager.UID();b={id:a,setting:JSON.parse(JSON.stringify(this.settings)),
gradient:this.getString(),css:b,points:d};themifyCM.gradients[a]=b;this.addSwatch(b);themifyColorManager.updateColorSwatches("gradients")};this.addSwatch=function(a,b){const c=f.createElement("li"),d=f.createElement("span");c.className="tb_gradient_swatch";c.style.background=a.css;c.dataset.id=a.id;d.className="tb_delete_swatch tf_close";c.appendChild(d);if(b)a=n.parentElement.getElementsByClassName("tb_gradient_swatches")[0],a.insertBefore(c,a.firstChild);else{a=ThemifyBuilderCommon.Lightbox.$lightbox[0].getElementsByClassName("tb_gradient_swatches");
for(let b=0,d=a.length;b<d;++b)a[b].insertBefore(c.cloneNode(!0),a[b].firstChild)}};this.swatchClicked=function(a){a.preventDefault();a=a.target;const b=a.classList;b.contains("tb_gradient_swatch")?this.selectSwatch(a.dataset.id):b.contains("tb_delete_swatch")&&(this.removeSwatch(a.parentNode.dataset.id),themifyColorManager.updateColorSwatches("gradients"))};this.removeSwatch=function(a){const b=ThemifyBuilderCommon.Lightbox.$lightbox[0].querySelectorAll('.tb_gradient_swatch[data-id="'+a+'"]');for(let a=
b.length-1;-1<a;--a)b[a].parentNode.removeChild(b[a]);delete themifyCM.gradients[a]};this.selectSwatch=function(a){a=themifyCM.gradients[a];this.setAngle(a.setting.angle);this.setRadialCircle(a.setting.circle);this.setType(a.setting.type);this.settings.gradient=a.gradient;this.update();var b=n.parentElement;const c=b.getElementsByClassName("themify-gradient-type")[0],d=b.querySelector('input[type="checkbox"]');b=b.getElementsByClassName("themify-gradient-angle")[0];c.value=a.setting.type;Themify.triggerEvent(c,
"change");d.checked=a.setting.circle;Themify.triggerEvent(d,"change");b.value=a.setting.angle;Themify.triggerEvent(b,"change")};this.initSwatches=function(){const a=Object.keys(themifyCM.gradients);themifyCM.gradients=a.length?themifyCM.gradients:{};for(let b=0,c=a.length;b<c;++b)this.addSwatch(themifyCM.gradients[a[b]],!0)};return this.__constructor()};g.ThemifyGradient.default="0% rgba(0,0,0, 1)|100% rgba(255,255,255,1)";g.fn.ThemifyGradient=function(f){return this.each(function(){void 0===g(this).data("themifyGradient")&&
g(this).data("themifyGradient",new g.ThemifyGradient(this,f))})}})(jQuery,window.top,window.top.document,tb_app);
